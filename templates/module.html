{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <h1 class="mb-3">{{ module.name }}</h1>
  <p class="text-muted">{{ module.description }}</p>

  {% if lessons and lessons|length > 0 %}
    {% for lesson in lessons %}
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">{{ lesson.title }}</h5>
          {% if lesson.content_rich %}
            <div class="mb-3">{{ lesson.content_rich|safe }}</div>
          {% endif %}

          {# Render lesson-level video if present #}
          {% if lesson.video_url %}
            {% set v = lesson.video_url %}
            {% if 'youtube.com' in v or 'youtu.be' in v %}
              <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:8px;" class="mb-3">
                <iframe src="{{ v }}" title="Lesson Video" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen
                        style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
              </div>
            {% else %}
              <video controls class="w-100 rounded mb-3" preload="metadata">
                <source src="{{ v }}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            {% endif %}
          {% endif %}

          {# Render topics #}
          {% if lesson.topics and lesson.topics|length > 0 %}
            <div class="mt-3">
              {% for t in lesson.topics %}
                <div class="mb-4">
                  <h6 class="mb-2">{{ t.title }}</h6>
                  {% if t.content_rich %}
                    <div class="mb-2">{{ t.content_rich|safe }}</div>
                  {% endif %}
                  {% if t.video_url %}
                    {% set tv = t.video_url %}
                    {% if 'youtube.com' in tv or 'youtu.be' in tv %}
                      <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:8px;">
                        <iframe src="{{ tv }}" title="Topic Video" frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                allowfullscreen
                                style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
                      </div>
                    {% else %}
                      <video controls class="w-100 rounded" preload="metadata">
                        <source src="{{ tv }}" type="video/mp4">
                        Your browser does not support the video tag.
                      </video>
                    {% endif %}
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% endif %}

        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="alert alert-info">No lessons available for this module yet.</div>
  {% endif %}
</div>
{% endblock %}


